<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>可編輯並可保存的HTML預覽器</title>
</head>
<body>
    <h2>可編輯並可保存的HTML預覽器</h2>

    <input type="file" id="fileInput" accept=".html">
    <button onclick="loadHTML()">載入HTML</button>
    <button onclick="saveHTML()">保存HTML</button>

    <br><br>

    <iframe id="htmlPreview" style="width:100%; height:400px;"></iframe>

    <script>
        function loadHTML() {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];
            var reader = new FileReader();

            reader.onload = function(e) {
                var htmlPreview = document.getElementById('htmlPreview');
                htmlPreview.srcdoc = e.target.result;
                setTimeout(() => makeEditable(htmlPreview), 500); // 等待iframe載入完成
            };

            reader.readAsText(file);
        }

        function makeEditable(htmlPreview) {
            var iframeDocument = htmlPreview.contentDocument || htmlPreview.contentWindow.document;
            makeContentEditable(iframeDocument.body);
        }

        function makeContentEditable(element) {
            if (element && element.childNodes.length > 0) {
                element.childNodes.forEach(child => {
                    if (child.nodeType === Node.ELEMENT_NODE) {
                        child.setAttribute('contenteditable', 'true');
                        makeContentEditable(child);
                    }
                });
            }
        }

        function saveHTML() {
            var htmlPreview = document.getElementById('htmlPreview');
            var iframeDocument = htmlPreview.contentDocument || htmlPreview.contentWindow.document;
            removeContentEditable(iframeDocument.body);

            var htmlContent = iframeDocument.documentElement.outerHTML;

            var blob = new Blob([htmlContent], { type: 'text/html' });
            var url = URL.createObjectURL(blob);

            var downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = 'edited.html';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            URL.revokeObjectURL(url);

            // 恢復contenteditable屬性以繼續編輯
            makeContentEditable(iframeDocument.body);
        }

        function removeContentEditable(element) {
            if (element && element.childNodes.length > 0) {
                element.childNodes.forEach(child => {
                    if (child.nodeType === Node.ELEMENT_NODE) {
                        child.removeAttribute('contenteditable');
                        removeContentEditable(child);
                    }
                });
            }
        }
    </script>
</body>
</html>
